!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["vanilla-wiz-sso"]=t():e["vanilla-wiz-sso"]=t()}(window,function(){return function(e){var t=window.webpackHotUpdatevanilla_wiz_sso;window.webpackHotUpdatevanilla_wiz_sso=function(e,n){!function(e,t){if(k[e]&&w[e]){for(var n in w[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(h[n]=t[n]);0==--v&&0===y&&O()}}(e,n),t&&t(e,n)};var n,r=!0,o="a33e57d625c5c5e8985d",i=1e4,s={},c=[],a=[];function d(e){var t=x[e];if(!t)return I;var r=function(r){return t.hot.active?(x[r]?-1===x[r].parents.indexOf(e)&&x[r].parents.push(e):(c=[e],n=r),-1===t.children.indexOf(r)&&t.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),c=[]),I(r)},o=function(e){return{configurable:!0,enumerable:!0,get:function(){return I[e]},set:function(t){I[e]=t}}};for(var i in I)Object.prototype.hasOwnProperty.call(I,i)&&"e"!==i&&"t"!==i&&Object.defineProperty(r,i,o(i));return r.e=function(e){return"ready"===u&&p("prepare"),y++,I.e(e).then(t,function(e){throw t(),e});function t(){y--,"prepare"===u&&(m[e]||b(e),0===y&&0===v&&O())}},r.t=function(e,t){return 1&t&&(e=r(e)),I.t(e,-2&t)},r}var l=[],u="idle";function p(e){u=e;for(var t=0;t<l.length;t++)l[t].call(null,e)}var f,h,_,v=0,y=0,m={},w={},k={};function g(e){return+e+""===e?+e:e}function T(e){if("idle"!==u)throw new Error("check() is only allowed in idle status");return r=e,p("check"),(t=i,t=t||1e4,new Promise(function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,i=I.p+""+o+".hot-update.json";r.open("GET",i,!0),r.timeout=t,r.send(null)}catch(e){return n(e)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+i+" timed out."));else if(404===r.status)e();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+i+" failed."));else{try{var t=JSON.parse(r.responseText)}catch(e){return void n(e)}e(t)}}})).then(function(e){if(!e)return p("idle"),null;w={},m={},k=e.c,_=e.h,p("prepare");var t=new Promise(function(e,t){f={resolve:e,reject:t}});return h={},b(0),"prepare"===u&&0===y&&0===v&&O(),t});var t}function b(e){k[e]?(w[e]=!0,v++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=I.p+""+e+"."+o+".hot-update.js",document.head.appendChild(t)}(e)):m[e]=!0}function O(){p("ready");var e=f;if(f=null,e)if(r)Promise.resolve().then(function(){return R(r)}).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var n in h)Object.prototype.hasOwnProperty.call(h,n)&&t.push(g(n));e.resolve(t)}}function R(t){if("ready"!==u)throw new Error("apply() is only allowed in ready status");var n,r,i,a,d;function l(e){for(var t=[e],n={},r=t.slice().map(function(e){return{chain:[e],id:e}});r.length>0;){var o=r.pop(),i=o.id,s=o.chain;if((a=x[i])&&!a.hot._selfAccepted){if(a.hot._selfDeclined)return{type:"self-declined",chain:s,moduleId:i};if(a.hot._main)return{type:"unaccepted",chain:s,moduleId:i};for(var c=0;c<a.parents.length;c++){var d=a.parents[c],l=x[d];if(l){if(l.hot._declinedDependencies[i])return{type:"declined",chain:s.concat([d]),moduleId:i,parentId:d};-1===t.indexOf(d)&&(l.hot._acceptedDependencies[i]?(n[d]||(n[d]=[]),f(n[d],[i])):(delete n[d],t.push(d),r.push({chain:s.concat([d]),id:d})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}t=t||{};var v={},y=[],m={},w=function(){console.warn("[HMR] unexpected require("+b.moduleId+") to disposed module")};for(var T in h)if(Object.prototype.hasOwnProperty.call(h,T)){var b;d=g(T);var O=!1,R=!1,j=!1,D="";switch((b=h[T]?l(d):{type:"disposed",moduleId:T}).chain&&(D="\nUpdate propagation: "+b.chain.join(" -> ")),b.type){case"self-declined":t.onDeclined&&t.onDeclined(b),t.ignoreDeclined||(O=new Error("Aborted because of self decline: "+b.moduleId+D));break;case"declined":t.onDeclined&&t.onDeclined(b),t.ignoreDeclined||(O=new Error("Aborted because of declined dependency: "+b.moduleId+" in "+b.parentId+D));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(b),t.ignoreUnaccepted||(O=new Error("Aborted because "+d+" is not accepted"+D));break;case"accepted":t.onAccepted&&t.onAccepted(b),R=!0;break;case"disposed":t.onDisposed&&t.onDisposed(b),j=!0;break;default:throw new Error("Unexception type "+b.type)}if(O)return p("abort"),Promise.reject(O);if(R)for(d in m[d]=h[d],f(y,b.outdatedModules),b.outdatedDependencies)Object.prototype.hasOwnProperty.call(b.outdatedDependencies,d)&&(v[d]||(v[d]=[]),f(v[d],b.outdatedDependencies[d]));j&&(f(y,[b.moduleId]),m[d]=w)}var P,H=[];for(r=0;r<y.length;r++)d=y[r],x[d]&&x[d].hot._selfAccepted&&H.push({module:d,errorHandler:x[d].hot._selfAccepted});p("dispose"),Object.keys(k).forEach(function(e){!1===k[e]&&function(e){delete installedChunks[e]}(e)});for(var A,E,M=y.slice();M.length>0;)if(d=M.pop(),a=x[d]){var S={},q=a.hot._disposeHandlers;for(i=0;i<q.length;i++)(n=q[i])(S);for(s[d]=S,a.hot.active=!1,delete x[d],delete v[d],i=0;i<a.children.length;i++){var C=x[a.children[i]];C&&(P=C.parents.indexOf(d))>=0&&C.parents.splice(P,1)}}for(d in v)if(Object.prototype.hasOwnProperty.call(v,d)&&(a=x[d]))for(E=v[d],i=0;i<E.length;i++)A=E[i],(P=a.children.indexOf(A))>=0&&a.children.splice(P,1);for(d in p("apply"),o=_,m)Object.prototype.hasOwnProperty.call(m,d)&&(e[d]=m[d]);var N=null;for(d in v)if(Object.prototype.hasOwnProperty.call(v,d)&&(a=x[d])){E=v[d];var $=[];for(r=0;r<E.length;r++)if(A=E[r],n=a.hot._acceptedDependencies[A]){if(-1!==$.indexOf(n))continue;$.push(n)}for(r=0;r<$.length;r++){n=$[r];try{n(E)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:d,dependencyId:E[r],error:e}),t.ignoreErrored||N||(N=e)}}}for(r=0;r<H.length;r++){var X=H[r];d=X.module,c=[d];try{I(d)}catch(e){if("function"==typeof X.errorHandler)try{X.errorHandler(e)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:d,error:n,originalError:e}),t.ignoreErrored||N||(N=n),N||(N=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:d,error:e}),t.ignoreErrored||N||(N=e)}}return N?(p("fail"),Promise.reject(N)):(p("idle"),new Promise(function(e){e(y)}))}var x={};function I(t){if(x[t])return x[t].exports;var r=x[t]={i:t,l:!1,exports:{},hot:function(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._acceptedDependencies[e[r]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:T,apply:R,status:function(e){if(!e)return u;l.push(e)},addStatusHandler:function(e){l.push(e)},removeStatusHandler:function(e){var t=l.indexOf(e);t>=0&&l.splice(t,1)},data:s[e]};return n=void 0,t}(t),parents:(a=c,c=[],a),children:[]};return e[t].call(r.exports,r,r.exports,d(t)),r.l=!0,r.exports}return I.m=e,I.c=x,I.d=function(e,t,n){I.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},I.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},I.t=function(e,t){if(1&t&&(e=I(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(I.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)I.d(n,r,function(t){return e[t]}.bind(null,r));return n},I.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return I.d(t,"a",t),t},I.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},I.p="",I.h=function(){return o},d(0)(I.s=0)}([function(e,t,n){"use strict";n.r(t);class r{static setToken(e){r._token={tokenType:e.token_type,hash:e.access_token,expiresIn:1e3*e.expires_in+r._getCurrentTime(),refreshToken:e.refresh_token},window.localStorage.setItem("auth_data",JSON.stringify(r._token))}static getToken(){return r._token}constructor(e){e.options||(e.options={}),e.options.tokenAutoRefresh||(e.options.tokenAutoRefresh=!0),e.options.ssoTimeout||(e.ssoTimeout=6e4),this.apiPath=e.apiPath,this.client_id=e.clientID,this.grant_type=e.grantType,this.client_secret=e.clientSecret,this.scope=e.scope,this.autoRefreshToken=e.options.tokenAutoRefresh,this.ssoTimeout=e.options.ssoTimeOut,this._ctrlRefreshInterval=null}_startAutoRefreshToken(){if(this.autoRefreshToken&&!this._ctrlRefreshInterval){var e=r._token.expiresIn-(r._getCurrentTime()-12e4);this._ctrlRefreshInterval=setTimeout(()=>{this._tryRenewToken()},Math.max(e,0))}}_tryRenewToken(){this.refreshToken().then(e=>{clearTimeout(this._ctrlRefreshInterval),this._ctrlRefreshInterval=null,this._startAutoRefreshToken()},e=>{r.onAutoRefreshFail&&r.onAutoRefreshFail()})}static _getCurrentTime(){return(new Date).getTime()}setAutoRefreshToken(e){this.autoRefreshToken=e}isLogged(){return new Promise((e,t)=>{var n=window.localStorage.getItem("auth_data");if(n){var o=JSON.parse(n),i=r._getCurrentTime();r._token={tokenType:o.tokenType,hash:o.hash,expiresIn:o.expiresIn,refreshToken:o.refreshToken},this.autoRefreshToken&&(r._token.expiresIn>=i?(this._startAutoRefreshToken(),e(r.getToken())):this.refreshToken().then(t=>{this._startAutoRefreshToken(),e(t)},e=>{t("Não foi possível renovar o token antigo!")}))}else t("Não há token")})}loginWithCredentials(e,t){return new Promise((n,i)=>{new o(this.ssoTimeout).request("post",`${this.apiPath}/connect/token`,"application/x-www-form-urlencoded",`grant_type=${this.grant_type}&username=${e}&password=${t}&client_id=${this.client_id}&client_secret=${this.client_secret}&scope=${this.scope}`).then(e=>{r.setToken(e),this.autoRefreshToken&&this._startAutoRefreshToken(),n(r.getToken())},e=>{i(e)})})}refreshToken(){return new Promise((e,t)=>{r.getToken()?new o(this.ssoTimeout).request("post",`${this.apiPath}/connect/token`,"application/x-www-form-urlencoded",`grant_type=refresh_token&client_id=${this.client_id}&client_secret=${this.client_secret}&refresh_token=${r._token.refreshToken}`).then(t=>{r.setToken(t),e(r.getToken())},e=>{t(e)}):t("Não há token há ser renovado!")})}logOut(){this._ctrlRefreshInterval&&clearTimeout(this._ctrlRefreshInterval),this._ctrlRefreshInterval=null,window.localStorage.removeItem("auth_data"),r._token=null}}class o{constructor(e=6e4){this.timeout=e,this.timeoutCtrl=null}request(e,t,n,r){return new Promise((o,i)=>{var s=this._getXMLHttpRequest();s.open(e,t,!0),s.setRequestHeader("Content-Type",n),this.timeoutCtrl=null,s.onreadystatechange=(()=>{s.readyState===XMLHttpRequest.DONE&&(clearTimeout(this.timeoutCtrl),"2"==(s.status+"").charAt(0)?o(JSON.parse(s.responseText)):i(JSON.parse(s.responseText)))}),this.timeoutCtrl=setTimeout(()=>{i({error:"timeout"})},this.timeout);var c="application/x-www-form-urlencoded"!=n?JSON.stringify(r):r;s.send(c)})}_getXMLHttpRequest(){return window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):void 0}}t.default=r}])});